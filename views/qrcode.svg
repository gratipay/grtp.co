{% extends "./svg.swig" %}

{% set width = 248 %}
{% set height = 248 %}

{% block svg %}
<defs>
    <clipPath id="heart">
        <path transform="translate(-66 -45) scale(0.25)" d="M 763,1046 413,573 q -16,-22 -24.5,-59 -8.5,-37 6,-85 14.5,-48 61.5,-79 40,-26 83,-25.5 43,0.5 73.5,17.5 30.5,17 54.5,45 36,40 96,40 59,0 95,-40 24,-28 54.5,-45 30.5,-17 73.5,-17.5 43,-0.5 84,25.5 46,31 60.5,79 14.5,48 6,85 -8.5,37 -24.5,59 z" />
    </clipPath>

    <path id="qr" shape-rendering="crispEdges" stroke-width="1"
          transform="translate(16 16) scale({{ (width - 32) / matrix.length }}) translate(0 0.5)"
          d="{% for y, row in matrix %}
                 {% set l = 0 %}
                 {% set s = 0 %}
                 {% for x, col in row %}
                     {% if col %}
                         {% set l += 1 %}

                         {% if l == 1 %}
                             {% set s = x %}
                         {% endif %}
                     {% endif %}

                     {% if l and ( not col or x == matrix.length - 1 ) %}
                         M{{s}},{{y}}h{{l}}z
                         {% set l = 0 %}
                     {% endif %}
                 {% endfor %}
             {% endfor %}" />
</defs>

<a xlink:href="https://gratipay.com/{{username}}/" target="_blank">
    <rect x="0" y="0" width="{{ width }}" height="{{ height }}" rx="3" fill="#396" />

    <rect x="8" y="8" width="{{ width - 16 }}" height="{{ height - 16 }}" rx="1.5" fill="#fff" />
    <use xlink:href="#qr" stroke="#396" />

    <g clip-path="url(#heart)">
        <rect x="0" y="0" width="{{ width }}" height="{{ height }}" rx="3" fill="#ffe8bb" />
        <use xlink:href="#qr" stroke="#630" />
    </g>
</a>
{% endblock %}
